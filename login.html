<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mer3i market - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto; background:#f3f5f9;}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px;}
    .card{width:min(520px,100%);background:#fff;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:22px;}
    h1{margin:0 0 14px;font-size:34px;text-align:center;}
    .btnRow{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin:14px 0;}
    button{border:0;border-radius:12px;padding:14px 16px;font-size:18px;cursor:pointer;width:min(240px,100%);}
    .primary{background:#2f7df6;color:#fff;}
    .soft{background:#e9eef6;color:#111;}
    .black{background:#111;color:#fff;}
    .field{margin:10px 0;}
    input{width:100%;box-sizing:border-box;border:1px solid #d6dbe5;border-radius:12px;padding:12px;font-size:16px;}
    .note{color:#666;text-align:center;margin-top:10px;font-size:14px;}
    .hidden{display:none;}
    .msg{margin-top:10px;text-align:center;font-size:14px}
    .ok{color:#1b7f2a} .err{color:#c62828}
    .link{color:#2f7df6;text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>

      <div class="btnRow">
        <button class="primary" id="tabEmail">âœ‰ï¸ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯</button>
        <button class="soft" id="tabPhone">ğŸ“± Ø¹Ø¨Ø± Ø§Ù„Ù‡Ø§ØªÙ</button>
      </div>

      <!-- EMAIL -->
      <div id="emailBox">
        <div class="field"><input id="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"></div>
        <div class="field"><input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"></div>
        <div class="btnRow">
          <button class="primary" id="btnLoginEmail">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
          <button class="soft" id="btnSignupEmail">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        </div>
        <div class="btnRow">
          <button class="soft" id="btnReset">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
        </div>
      </div>

      <!-- PHONE -->
      <div id="phoneBox" class="hidden">
        <div class="field">
          <input id="phone" type="tel" placeholder="+96170123456 (Ù…Ø¹ ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø©)">
        </div>
        <div id="recaptcha-container"></div>
        <div class="btnRow">
          <button class="primary" id="btnSendCode">Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯</button>
          <button class="soft" id="btnClearPhone">Ù…Ø³Ø­</button>
        </div>

        <div id="otpBox" class="hidden">
          <div class="field">
            <input id="otp" type="text" inputmode="numeric" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ SMS">
          </div>
          <div class="btnRow">
            <button class="primary" id="btnVerifyCode">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯</button>
          </div>
        </div>
      </div>

      <hr style="border:0;border-top:1px solid #e9eef6;margin:16px 0">

      <div class="btnRow">
        <button class="black" id="btnInquiry">ğŸ’¬ Ø§Ø³ØªÙØ³Ø§Ø±</button>
      </div>

      <div class="msg" id="msg"></div>
      <div class="note">Ø¥Ø°Ø§ ÙƒÙ†Øª Ù…Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ Ù…Ù† Ù‚Ø¨Ù„ØŒ Ø³ÙŠØªÙ… ÙØªØ­ Ø§Ù„ØµÙØ­Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</div>
    </div>
  </div>

  <!-- Firebase (CDN modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getAuth, onAuthStateChanged,
      createUserWithEmailAndPassword, signInWithEmailAndPassword,
      sendPasswordResetEmail,
      RecaptchaVerifier, signInWithPhoneNumber
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    // âœ… CONFIG (ÙƒÙ…Ø§ Ø£Ø±Ø³Ù„ØªÙ‡)
    const firebaseConfig = {
      apiKey: "AIzaSyDdChxB8Axden4r5TChcL_wuwuGUZfL0yk",
      authDomain: "mer3imarket.firebaseapp.com",
      projectId: "mer3imarket",
      storageBucket: "mer3imarket.firebasestorage.app",
      messagingSenderId: "318791325244",
      appId: "1:318791325244:web:2a35c7fe774ab1772f5539",
      measurementId: "G-4ZR3G6DEN4"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const $ = (id)=>document.getElementById(id);
    const msg = (text, type="ok")=>{
      const el = $("msg");
      el.className = "msg " + (type==="ok" ? "ok" : "err");
      el.textContent = text;
    };

    // âœ… Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ -> Ø±ÙˆØ­ Ù„Ù„Ù€ index Ù…Ø¨Ø§Ø´Ø±Ø©
    onAuthStateChanged(auth, (user)=>{
      if(user){
        window.location.href = "index.html";
      }
    });

    // Tabs
    $("tabEmail").onclick = ()=>{
      $("emailBox").classList.remove("hidden");
      $("phoneBox").classList.add("hidden");
      msg("");
    };
    $("tabPhone").onclick = ()=>{
      $("phoneBox").classList.remove("hidden");
      $("emailBox").classList.add("hidden");
      msg("");
    };

    // Email login / signup
    $("btnLoginEmail").onclick = async ()=>{
      const email = $("email").value.trim();
      const password = $("password").value.trim();
      if(!email || !password) return msg("Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "err");
      try{
        await signInWithEmailAndPassword(auth, email, password);
        msg("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
        window.location.href = "index.html";
      }catch(e){
        msg(e.message, "err");
      }
    };

    $("btnSignupEmail").onclick = async ()=>{
      const email = $("email").value.trim();
      const password = $("password").value.trim();
      if(!email || !password) return msg("Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "err");
      if(password.length < 6) return msg("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø±", "err");
      try{
        await createUserWithEmailAndPassword(auth, email, password);
        msg("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ…");
        window.location.href = "index.html";
      }catch(e){
        msg(e.message, "err");
      }
    };

    $("btnReset").onclick = async ()=>{
      const email = $("email").value.trim();
      if(!email) return msg("Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯Ùƒ Ø£ÙˆÙ„Ø§Ù‹", "err");
      try{
        await sendPasswordResetEmail(auth, email);
        msg("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± âœ…");
      }catch(e){
        msg(e.message, "err");
      }
    };

    // Phone auth (reCAPTCHA)
    let confirmationResult = null;

    const recaptcha = new RecaptchaVerifier(auth, "recaptcha-container", {
      size: "invisible",
    });

    $("btnSendCode").onclick = async ()=>{
      const phone = $("phone").value.trim();
      if(!phone.startsWith("+")) return msg("Ù„Ø§Ø²Ù… Ø§Ù„Ø±Ù‚Ù… ÙŠØ¨Ø¯Ø£ + Ù…Ø¹ ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© (Ù…Ø«Ø§Ù„ +961...)", "err");
      try{
        confirmationResult = await signInWithPhoneNumber(auth, phone, recaptcha);
        $("otpBox").classList.remove("hidden");
        msg("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ âœ…");
      }catch(e){
        msg(e.message, "err");
      }
    };

    $("btnVerifyCode").onclick = async ()=>{
      const code = $("otp").value.trim();
      if(!confirmationResult) return msg("Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹", "err");
      if(code.length < 4) return msg("Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØµØ­ÙŠØ­", "err");
      try{
        await confirmationResult.confirm(code);
        msg("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
        window.location.href = "index.html";
      }catch(e){
        msg("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØªÙ‡", "err");
      }
    };

    $("btnClearPhone").onclick = ()=>{
      $("phone").value = "";
      $("otp").value = "";
      $("otpBox").classList.add("hidden");
      msg("");
    };

    // Inquiry button
    $("btnInquiry").onclick = ()=>{
      window.location.href = "inquiry.html";
    };
  </script>
</body>
</html>
