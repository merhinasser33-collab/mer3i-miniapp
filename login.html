<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ - Mer3i</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#f6f7fb;color:#111}
    .wrap{max-width:520px;margin:24px auto;padding:0 14px}
    .card{background:#fff;border-radius:18px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.08);border:1px solid rgba(0,0,0,.06)}
    h1{margin:0 0 10px;font-size:24px}
    .muted{color:#666;line-height:1.6;margin:6px 0 0}
    label{display:block;margin-top:12px;font-size:14px;color:#333}
    input{
      width:100%;box-sizing:border-box;margin-top:6px;
      padding:12px 12px;border-radius:12px;border:1px solid #d9dfea;
      font-size:16px;outline:none;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    button,a.btn{
      border:0;border-radius:14px;padding:12px 14px;font-size:16px;cursor:pointer;
      background:#2b7cff;color:#fff;text-decoration:none;display:inline-flex;align-items:center;gap:8px;
    }
    button.secondary,a.btn.secondary{background:#111}
    button.gray{background:#e9edf5;color:#111}
    .msg{margin-top:12px;padding:10px 12px;border-radius:12px;font-size:14px;display:none}
    .ok{background:#e9fff0;color:#0a8f3e;border:1px solid rgba(10,143,62,.2)}
    .bad{background:#fff1f1;color:#c62828;border:1px solid rgba(198,40,40,.2)}
    .hide{display:none!important}
    .hr{height:1px;background:rgba(0,0,0,.08);margin:14px 0}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h1>
      <p class="muted">
        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¢Ù† âœ…<br>
        (Ø¨Ø¹Ø¯Ù‡Ø§ Ù†Ø¶ÙŠÙ ØªØ³Ø¬ÙŠÙ„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ OTP Ø¹Ø¨Ø± Firebase)
      </p>

      <div id="msg" class="msg"></div>

      <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <input id="email" type="email" placeholder="example@mail.com" autocomplete="email" />

      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input id="pass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />

      <div class="row">
        <button onclick="loginEmail()">âœ… Ø¯Ø®ÙˆÙ„</button>
        <button class="secondary" onclick="signupEmail()">â• Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        <button class="gray" onclick="goHome()">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
      </div>

      <div class="hr"></div>

      <div id="userBox" class="hide">
        <p class="muted">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…</p>
        <div class="row">
          <button class="secondary" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
          <button onclick="goHome()">ğŸ  Ù„Ù„Ù…ØªØ¬Ø±</button>
        </div>
      </div>

      <p class="muted" style="margin-top:12px;font-size:13px">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù† Ù†Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø£Ùˆ Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ù†Ø§Ø³.
      </p>
    </div>
  </div>

  <script type="module">
    import { firebaseConfig } from "./firebase.js";

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getAuth,
      setPersistence,
      browserLocalPersistence,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Ø®Ù„ÙŠ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²
    await setPersistence(auth, browserLocalPersistence);

    const $ = (id) => document.getElementById(id);
    const msgEl = $("msg");

    function showMsg(text, ok=true){
      msgEl.style.display = "block";
      msgEl.className = "msg " + (ok ? "ok" : "bad");
      msgEl.textContent = text;
    }

    function hideMsg(){
      msgEl.style.display = "none";
    }

    window.loginEmail = async function(){
      hideMsg();
      const email = $("email").value.trim();
      const pass = $("pass").value.trim();
      if(!email || !pass) return showMsg("Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.", false);

      try{
        await signInWithEmailAndPassword(auth, email, pass);
        showMsg("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
      }catch(e){
        showMsg("Ø®Ø·Ø£: " + (e?.message || e), false);
      }
    }

    window.signupEmail = async function(){
      hideMsg();
      const email = $("email").value.trim();
      const pass = $("pass").value.trim();
      if(!email || !pass) return showMsg("Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.", false);
      if(pass.length < 6) return showMsg("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø§Ø²Ù… 6 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø±.", false);

      try{
        await createUserWithEmailAndPassword(auth, email, pass);
        showMsg("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
      }catch(e){
        showMsg("Ø®Ø·Ø£: " + (e?.message || e), false);
      }
    }

    window.logout = async function(){
      await signOut(auth);
      showMsg("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ âœ…");
    }

    window.goHome = function(){
      location.href = "/index.html";
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    onAuthStateChanged(auth, (user) => {
      if(user){
        $("userBox").classList.remove("hide");
      }else{
        $("userBox").classList.add("hide");
      }
    });

    // Telegram polish
    try{
      const tg = window.Telegram?.WebApp;
      if(tg){ tg.ready(); tg.expand(); }
    }catch{}
  </script>
</body>
</html>
