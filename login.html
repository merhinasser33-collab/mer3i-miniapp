<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | Mer3i Market</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f6fa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .box {
      background: #fff;
      padding: 20px;
      width: 100%;
      max-width: 380px;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 15px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 6px;
      background: #2f80ed;
      color: #fff;
      font-size: 15px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    button.secondary {
      background: #eaeaea;
      color: #333;
    }
    .hidden {
      display: none;
    }
    .note {
      font-size: 12px;
      color: #666;
      text-align: center;
      margin-top: 5px;
    }
  </style>
</head>

<body>

<div class="box">
  <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>

  <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© -->
  <button onclick="showEmail()">ğŸ“§ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯</button>
  <button class="secondary" onclick="showPhone()">ğŸ“± Ø¹Ø¨Ø± Ø§Ù„Ù‡Ø§ØªÙ</button>

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ -->
  <div id="emailBox" class="hidden">
    <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="loginEmail()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ù„Ù‡Ø§ØªÙ -->
  <div id="phoneBox" class="hidden">
    <input type="text" id="phone" placeholder="+96170123456">
    <div id="recaptcha-container"></div>
    <button onclick="sendCode()">Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯</button>

    <input type="text" id="code" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚">
    <button onclick="verifyCode()">ØªØ£ÙƒÙŠØ¯</button>
  </div>

  <div class="note">
    ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ Firebase ÙÙ‚Ø·
  </div>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    RecaptchaVerifier,
    signInWithPhoneNumber
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  // ğŸ”¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (ÙƒÙ…Ø§ Ø£Ø¹Ø·ÙŠØªÙ†ÙŠ)
  const firebaseConfig = {
    apiKey: "AIzaSyDdChxB8Axden4r5TChcL_wuwuGUZfL0yk",
    authDomain: "mer3imarket.firebaseapp.com",
    projectId: "mer3imarket",
    storageBucket: "mer3imarket.firebasestorage.app",
    messagingSenderId: "318791325244",
    appId: "1:318791325244:web:2a35c7fe774ab1772f5539",
    measurementId: "G-4ZR3G6DEN4"
  };

  // Init
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  window.auth = auth;

  // ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ Ù…Ø³Ø¬Ù‘Ù„
  onAuthStateChanged(auth, (user) => {
    if (user) {
      window.location.href = "index.html";
    }
  });

  // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  window.showEmail = () => {
    document.getElementById("emailBox").classList.remove("hidden");
    document.getElementById("phoneBox").classList.add("hidden");
  };

  window.showPhone = () => {
    document.getElementById("phoneBox").classList.remove("hidden");
    document.getElementById("emailBox").classList.add("hidden");

    window.recaptchaVerifier = new RecaptchaVerifier(
      auth,
      "recaptcha-container",
      { size: "invisible" }
    );
  };

  // ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯
  window.loginEmail = async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    try {
      await signInWithEmailAndPassword(auth, email, password);
    } catch (e) {
      alert(e.message);
    }
  };

  // Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø§ØªÙ
  window.sendCode = async () => {
    const phone = document.getElementById("phone").value;

    try {
      window.confirmationResult =
        await signInWithPhoneNumber(auth, phone, window.recaptchaVerifier);
      alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯");
    } catch (e) {
      alert(e.message);
    }
  };

  // ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯
  window.verifyCode = async () => {
    const code = document.getElementById("code").value;
    try {
      await window.confirmationResult.confirm(code);
    } catch (e) {
      alert(e.message);
    }
  };
</script>

</body>
</html>
