<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mer3i Market</title>

  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#f6f7fb;color:#111}
    .wrap{max-width:720px;margin:24px auto;padding:0 14px}
    .card{background:#fff;border-radius:18px;padding:18px;box-shadow:0 8px 22px rgba(0,0,0,.08);border:1px solid rgba(0,0,0,.06)}
    .top{display:flex;align-items:center;justify-content:center;gap:10px}
    .title{font-size:30px;margin:10px 0 4px;font-weight:800;text-align:center}
    .sub{margin:0;text-align:center;color:#2f7d32;font-weight:700}
    .muted{color:#666;line-height:1.6;text-align:center;margin:10px 0 0}
    .row{display:flex;flex-direction:column;gap:12px;margin-top:16px}
    button,a.btn{border:0;border-radius:14px;padding:14px 16px;font-size:18px;cursor:pointer;background:#2b7cff;color:#fff;text-decoration:none;display:flex;align-items:center;justify-content:center;gap:10px}
    .gray{background:#e9edf5;color:#111}
    .dark{background:#111}
    .hide{display:none !important}
    .small{font-size:12px;color:#999;text-align:center;margin-top:12px}
    .hint{font-size:13px;color:#777;text-align:center;margin-top:10px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div style="font-size:34px">âœ…</div>
        <div class="title">Mer3i Market</div>
        <div style="font-size:34px">ğŸ›’</div>
      </div>

      <p class="sub" id="statusText">Ø¬Ø§Ù‡Ø²</p>
      <p class="hint" id="hintText"></p>

      <div class="row">
        <!-- Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
        <button id="btnLogin" onclick="goLogin()">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
        <button class="gray" id="btnAsk" onclick="goAsk()">ğŸ’¬ Ø§Ø³ØªÙØ³Ø§Ø±</button>

        <!-- Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· -->
        <button class="dark hide" id="btnAdmin" onclick="goAdmin()">ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>

        <button class="gray" onclick="location.reload()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
      </div>

      <div class="small" id="dbg"></div>
    </div>
  </div>

  <script>
    /***********************
     * 1) Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯ÙŠØ± (ID) - ØºÙŠÙ‘Ø±Ù‡ Ø¥Ø°Ø§ Ù„Ø²Ù…
     ***********************/
    const ADMIN_ID = 5423756075; // Ø±Ù‚Ù…Ùƒ Ø£Ù†Øª

    /***********************
     * 2) Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙØ­Ø§Øª
     * Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ø­Ø³Ø¨ Ù…Ù„ÙØ§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ
     ***********************/
    const PAGE_LOGIN = "login.html";   // Ø³Ù†Ø¹Ù…Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ (Firebase)
    const PAGE_ADMIN = "admin.html";   // Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ù†Ø¯Ùƒ
    const BOT_LINK  = "https://t.me/Mer3iMarket_bot"; // Ø¨ÙˆØªÙƒ

    const $ = (id) => document.getElementById(id);

    function getTG(){
      const tg = window.Telegram?.WebApp;
      if (!tg) return { ok:false, reason:"Ø§ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù…Ù† Ø¯Ø§Ø®Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… (Mini App) Ø­ØªÙ‰ ØªØ¹Ù…Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙŠØ²Ø§Øª." };
      tg.ready(); tg.expand();
      const user = tg.initDataUnsafe?.user;
      return { ok:true, tg, user };
    }

    function initUI(){
      const res = getTG();

      // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ© Ù„Ù„Ù†Ø§Ø³
      $("dbg").textContent = "";

      if (!res.ok){
        $("statusText").textContent = "Ø§ÙØªØ­Ù‡Ø§ Ù…Ù† Ø¯Ø§Ø®Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…";
        $("hintText").textContent = "Ø¥Ø°Ø§ ÙØªØ­ØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ù„Ù† Ù†Ø³ØªØ·ÙŠØ¹ Ù…Ø¹Ø±ÙØ© ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ± Ø£Ùˆ Ù…ÙŠØ²Ø§Øª Ø§Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….";
        // Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙŠØ¨Ù‚Ù‰ Ù…Ø®ÙÙŠ
        return;
      }

      $("statusText").textContent = "âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¯Ø§Ø®Ù„ Telegram Mini App";
      $("hintText").textContent = "";

      const userId = res.user?.id ? Number(res.user.id) : null;
      const isAdmin = userId && (userId === Number(ADMIN_ID));

      // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙ‚Ø· Ù„Ù„Ù…Ø¯ÙŠØ±
      if (isAdmin){
        $("btnAdmin").classList.remove("hide");
      } else {
        $("btnAdmin").classList.add("hide");
      }

      // ÙØ­Øµ Ø³Ø±ÙŠØ¹ Ø¨Ø¯ÙˆÙ† ÙƒØ´Ù Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
      $("dbg").textContent = `WEBAPP: YES`;
    }

    function goLogin(){
      // Ø­Ø§Ù„ÙŠØ§ Ù†ÙØªØ­ ØµÙØ­Ø© login.html (Ø³Ù†Ø¨Ù†ÙŠÙ‡Ø§ Firebase Auth)
      location.href = PAGE_LOGIN;
    }

    function goAdmin(){
      // Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©: Ø­ØªÙ‰ Ù„Ùˆ Ø¸Ù‡Ø± Ø§Ù„Ø²Ø± Ø¨Ø§Ù„ØºÙ„Ø·
      const res = getTG();
      const userId = res.user?.id ? Number(res.user.id) : null;
      if (!userId || userId !== Number(ADMIN_ID)){
        alert("Ù…Ù…Ù†ÙˆØ¹: Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·.");
        return;
      }
      location.href = PAGE_ADMIN;
    }

    function goAsk(){
      // Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØª (Ø£ÙØ¶Ù„ ÙˆØ£Ø¨Ø³Ø·)
      window.open(BOT_LINK, "_blank");
    }

    initUI();
  </script>
</body>
</html>
